<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>消息 - 金融借贷平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            padding-bottom: 70px;
        }

        .welcome-header {
            background-color: #1976D2;
            color: white;
            padding: 20px 15px;
            text-align: center;
        }

        .welcome-text {
            font-size: 22px;
            font-weight: bold;
        }

        .welcome-subtext {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .msg-category {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding: 10px 15px;
            background-color: white;
            border-bottom: 1px solid #eee;
        }

        .category-item {
            padding: 5px 15px;
            margin-right: 10px;
            border-radius: 15px;
            font-size: 14px;
            background-color: #f5f5f5;
            color: #666;
        }

        .category-item.active {
            background-color: #1976D2;
            color: white;
        }

        .msg-container {
            margin: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 10px;
            margin-bottom: 80px;
        }

        .msg-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .msg-item {
            padding: 15px;
            border-radius: 8px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .msg-item:active {
            transform: scale(0.98);
        }

        .msg-time {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: #666;
        }

        .msg-content {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .msg-detail {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            font-size: 12px;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .nav-item.active {
            color: #1976D2;
        }

        /* 新增消息按钮样式 */
        /*.add-message-btn {*/
        /*    position: fixed;*/
        /*    bottom: 80px;*/
        /*    right: 20px;*/
        /*    width: 50px;*/
        /*    height: 50px;*/
        /*    background-color: #1976D2;*/
        /*    color: white;*/
        /*    border-radius: 50%;*/
        /*    display: flex;*/
        /*    justify-content: center;*/
        /*    align-items: center;*/
        /*    font-size: 24px;*/
        /*    box-shadow: 0 2px 10px rgba(0,0,0,0.2);*/
        /*    cursor: pointer;*/
        /*    z-index: 99;*/
        /*}*/
    </style>
</head>
<body>
<!-- 欢迎头部 -->
<div class="welcome-header">
    <div class="welcome-text">消息中心</div>
    <div class="welcome-subtext">最新消息推送</div>
    <div id="currentTime" style="font-size: 14px; margin-top: 10px;"></div>
</div>

<!-- 消息分类 -->
<div class="msg-category">
    <div class="category-item active">全部消息</div>
    <div class="category-item">系统通知</div>
    <div class="category-item">交易提醒</div>
    <div class="category-item">营销活动</div>
    <div class="category-item">客服消息</div>
</div>

<!-- 消息容器 -->
<div class="msg-container">
    <div class="msg-list" id="messageList">
        <!-- 初始消息将通过JavaScript动态添加 -->
    </div>
</div>

<!-- 新增消息按钮 -->


<!-- 底部导航栏 -->
<div class="nav">
    <a href="index.html" class="nav-item">
        <i class="fas fa-home"></i>
        <span>首页</span>
    </a>
    <a href="loan.html" class="nav-item">
        <i class="fas fa-money-bill-wave"></i>
        <span>贷款</span>
    </a>
    <a href="message.html" class="nav-item active">
        <i class="fas fa-bell"></i>
        <span>消息</span>
    </a>
    <a href="mine.html" class="nav-item">
        <i class="fas fa-user"></i>
        <span>我的</span>
    </a>
</div>

<script>
    // 时间自动更新
    function updateTime() {
        const now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        hours = hours < 10 ? '0' + hours : hours;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        const timeString = hours + ':' + minutes;
        document.getElementById('currentTime').textContent = timeString;
    }

    // 初始化时间并设置定时器
    updateTime();
    setInterval(updateTime, 60000);

    // 消息数据
    const messageData = [
        {
            time: "12:00",
            title: "还款提醒",
            content: "您的贷款即将于3天后到期，请及时还款，避免产生逾期费用。",
            bgColor: "#FFF3E0"
        },
        {
            time: "昨天",
            title: "审核通过",
            content: "恭喜！您的申请已审核通过，额度已授信100000元，资金已打入您的银行卡。",
            bgColor: "#E8F5E9"
        },
        {
            time: "昨天",
            title: "信息核对",
            content: "您的信息已成功提交，我们将尽快为您进行审核，请耐心等待。",
            bgColor: "#E3F2FD"
        },
        {
            time: "2天前",
            title: "活动通知",
            content: "新用户专享优惠，首笔贷款免息30天，点击查看详情。",
            bgColor: "#F3E5F5"
        },
        {
            time: "3天前",
            title: "总授信提升",
            content: "您的信用评级已提升，总授信额度已提升至200000元，可申请最高贷款额度已更新。",
            bgColor: "#FFF3E0"
        },
        {
            time: "1周前",
            title: "系统通知",
            content: "系统将于今晚23:00-次日凌晨2:00进行维护升级，期间部分功能可能暂时无法使用，请您错峰操作。",
            bgColor: "#E0F7FA"
        }
    ];

    // 消息类型数据
    const messageTypes = [
        { type: "系统通知", bgColor: "#E0F7FA" },
        { type: "交易提醒", bgColor: "#FFF3E0" },
        { type: "营销活动", bgColor: "#F3E5F5" },
        { type: "客服消息", bgColor: "#E3F2FD" },
        { type: "额度调整", bgColor: "#E8F5E9" }
    ];

    // 获取消息列表容器
    const messageList = document.getElementById('messageList');

    // 渲染初始消息
    function renderMessages() {
        messageData.forEach(msg => {
            addMessageElement(msg.time, msg.title, msg.content, msg.bgColor);
        });
    }

    // 添加消息元素到DOM
    function addMessageElement(time, title, content, bgColor) {
        console.log("将生成好的消息添加到消息栏")
        const msgItem = document.createElement('div');
        msgItem.className = 'msg-item';
        msgItem.style.background = bgColor;
        msgItem.innerHTML = `
                <div class="msg-time">${time}</div>
                <div class="msg-content">${title}</div>
                <div class="msg-detail">${content}</div>
            `;

        // 添加点击事件
        msgItem.addEventListener('click', function() {
            alert(`消息详情\n\n${title}\n${content}`);
        });

        // 将新消息插入到列表顶部
        messageList.insertBefore(msgItem, messageList.firstChild);
    }

    // 生成随机消息
    function generateRandomMessage() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const formattedTime = `${hours < 10 ? '0' + hours : hours}:${minutes < 10 ? '0' + minutes : minutes}`;

        const randomType = messageTypes[Math.floor(Math.random() * messageTypes.length)];
        const randomContent = getRandomContent(randomType.type);

        return {
            time: formattedTime,
            title: randomType.type,
            content: randomContent,
            bgColor: randomType.bgColor
        };
    }
    function generateApplyMessage() {
        console.log("正在执行生成消息操作")
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const formattedTime = `${hours < 10 ? '0' + hours : hours}:${minutes < 10 ? '0' + minutes : minutes}`;

        const Type = messageTypes[1];
        const Content = getRandomContent(Type.type,0);

        return {
            time: formattedTime,
            title: Type.type,
            content: Content,
            bgColor: Type.bgColor
        };
    }

    // 根据消息类型生成内容
    function getRandomContent(type, select) {
        //传入类型以及需要类型中的第几条消息
        const contents = {
            "系统通知": [
                "系统将于今晚进行维护升级，预计耗时2小时。",
                "新版本已上线，修复了若干已知问题。",
                "系统检测到您的账户有异常登录，请及时查看。"
            ],
            "交易提醒": [
                "您的借款申请已提交成功，正在审核中。",
                "您有一笔还款即将到期，请确保账户余额充足。",
                "您的账户收到一笔转账，金额为5000元。"
            ],
            "营销活动": [
                "限时优惠！本月借款利率下调1%。",
                "邀请好友注册，双方各得100元现金券。",
                "新用户专享：首笔借款免息30天。"
            ],
            "客服消息": [
                "您的问题已收到，客服将在24小时内回复。",
                "感谢您的反馈，我们已记录您的问题。",
                "您的投诉已受理，我们将尽快处理。"
            ],
            "额度调整": [
                "您的信用额度已提升至150000元。",
                "根据您的信用评级，可借款额度已更新。",
                "临时额度申请已通过，有效期至本月底。"
            ]
        };

        // const options = contents[type] || ["这是一条新消息，请查看详情。"];
        const options = contents[type];
        return options[select];
    }

    // 为消息分类添加点击事件
    document.querySelectorAll('.category-item').forEach(item => {
        item.addEventListener('click', function() {
            // 移除所有活跃状态
            document.querySelectorAll('.category-item').forEach(cat => {
                cat.classList.remove('active');
            });
            // 添加当前活跃状态
            this.classList.add('active');
            // 这里可以添加根据分类筛选消息的逻辑
            const category = this.textContent;
            console.log(`切换到${category}`);
        });
    });

    // 为导航项添加点击事件
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
            // 移除所有活跃状态
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            // 添加当前活跃状态
            this.classList.add('active');
        });
    });

    // 添加消息按钮点击事件
    // document.getElementById('addMessageBtn').addEventListener('click', function() {
    //     const newMessage = generateRandomMessage();
    //     addMessageElement(newMessage.time, newMessage.title, newMessage.content, newMessage.bgColor);
    //
    //     // 可以添加动画效果
    //     this.style.transform = 'scale(1.2)';
    //     setTimeout(() => {
    //         this.style.transform = 'scale(1)';
    //     }, 300);
    // });

    // 初始化渲染消息
    renderMessages();
    const messageChannel = new BroadcastChannel('loan_messages');
    // 收到消息的广播
    document.addEventListener('DOMContentLoaded', function() {
        const messageChannel = new BroadcastChannel('loan_messages');
        messageChannel.addEventListener('message', (event) => {
            console.log('收到消息：', event.data);
            if (event.data.type === 'newLoanApply') {
                const newMessage = generateApplyMessage();
                addMessageElement(newMessage.time, newMessage.title, newMessage.content, newMessage.bgColor);
            }
        });
    });

    function generateNewMessage(data) {
        // 生成新消息的逻辑
    }
    // 模拟实时消息推送（每30秒随机添加一条新消息）
    // setInterval(() => {
    //     const newMessage = generateRandomMessage();
    //     addMessageElement(newMessage.time, newMessage.title, newMessage.content, newMessage.bgColor);
    // }, 30000);
</script>
</body>
</html>